<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org/">
<head>
	<title th:text="${activity != null ? activity.name : '活动位置'}">活动地址</title>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=0">
	<style th:inline="css">
        * {
            margin: 0;
            padding: 0;
        }

        body {
            /*font-family: 微软雅黑, 黑体, Arial, Helvetica, sans-serif;*/
            /*font-family: "SF Pro Display","Helvetica Neue",Helvetica, Tahoma, Arial, "PingFang SC", "Hiragino Sans GB", "Heiti SC", "Microsoft YaHei",sans-serif,'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol','Noto Color Emoji';*/
            font-family: "SF Pro Display", "Helvetica Neue", Helvetica, Tahoma, Arial, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
            -webkit-font-smoothing: antialiased;
        }
        body a {
            color: inherit;
            text-decoration: none
        }

        /*地图 2*/
        .static-map-style1{
            min-height: 300px;
        }
        .static-map-style1 .map-box{
            position: absolute;
            width: 100%;
            height: 100%;
        }
        .static-map-style1 .eng-map-container{
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        .static-map-style1 .map-box .BMapLabel{
            border: 1px solid #E9E9E9 !important;
            border-radius: 4px;
        }
        .static-map-style1 .map-box .info-window-box{
            position: relative;
            color: #333333;
            font-size: 14px;
            /*height: 20px;*/
            line-height: 20px;
            font-family:"PingFang SC";

            width: 327px;
            height: 60px;
            white-space: normal;
            text-align: center;
        }
        .static-map-style1 .map-box .info-window-box .info-link{
            display: block;
            position: relative;
            height: 100%;
            padding: 10px;
            box-sizing: border-box;
        }
        .static-map-style1 .map-box .info-window-box .center-txt{
            position: absolute;
            top: 50%;
            left: 10px;
            width: calc(100% - 20px);
            transform: translateY(-50%);
            max-height: 40px;
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;

        }
        .static-map-style1 .markerPop{
            text-align: left;
        }
        .static-map-style1 .markerPop tr .label{
            width: 70px;
            vertical-align: top;
        }
        .static-map-style1 .markerPop tr .pop-img{
            width: 100%;
            height: 120px;
            margin: 5px 0;
        }
        .static-map-style1 .markerPop tr .link-td{
            text-align: right;
            line-height: 30px;
            white-space: nowrap;
        }

        .static-map-style1 .markerPop tr .link-td.tl{
            text-align: left;
        }

        .static-map-style1 .markerPop tr .link{
            color: #428bca;
            text-decoration: none;
        }

        .static-map-style1 .BMap_bubble_content {
            font-size: 14px;
            line-height: 24px;
            color: #555555;
        }
        .static-map-style1 .BMap_bubble_title {
            text-overflow: ellipsis;
            max-width: 90%;
        }
        .static-map-style1 .empty-data {
            width: 100%;
            height: 100%;
            background-image: url([(@{/mapIframe/bg-pc.png})]);
            background-repeat: no-repeat;
            background-position: center center;
            background-size: cover;
        }
        .static-map-style1 .empty-data .empty-txt{
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: white;
            box-sizing: border-box;
            color: #333333;
            font-size: 14px;
            line-height: 20px;
            padding: 10px;
            border: 1px solid #E9E9E9;
            box-shadow: 0px 12px 24px rgba(0, 0, 0, 0.04);
            border-radius: 4px;
        }
        @media only screen and (min-width: 1px) and (max-width: 767px) {
            .static-map-style1 {
                min-width: 0;
                min-height: 18.75rem;
            }
            .static-map-style1 .map-box{
                overflow-y: auto;
            }
            .static-map-style1 .map-box .info-window-box .info-link{
                padding: 16px;
            }
            .static-map-style1 .map-box .BMap_Marker>div,
            .static-map-style1 .map-box .BMap_Marker>div img{
                width: 2rem !important;
                height: 2rem !important;
            }
            .static-map-style1 .map-box .info-window-box .center-txt{
                left: 16px;
                width: calc(100% - 32px);
                font-size: 1rem;
            }
            .static-map-style1 .empty-data {
                background-image: url("bg-app.png");
                background-size: cover;
            }
            .static-map-style1 .empty-data .empty-txt{
                font-size: 0.6875rem;
                line-height: 0.9375rem;
                padding: 0.5rem;
                box-shadow: 0 0.375rem 0.75rem rgba(0, 0, 0, 0.04);
                border-radius:0.25rem;
            }
        }
		[v-cloak] {
			display: none;
        }
	</style>
</head>
<body>
<div id="vm" v-cloak style="position: relative;">
	<div class="static-map-style1" style="background-color: white;position: relative;">
		<div class="map-box">
			<!--有数据-->
			<div class="eng-map-container" v-if="lat"></div>
			<!-- 空数据 -->
			<div class="empty-data" v-else>
				<p class="empty-txt">暂无线下举办地点</p>
			</div>
		</div>
	</div>
</div>
<div th:replace="pc/include/common_js :: common_js(~{::script})">
	<script src="//api.map.baidu.com/api?v=3.0&ak=aG5nWGO5m5tkVhBHGuVppoIRfKbyp5H3"></script>
	<script src="/static/pc/assets/js/app.pc.js" th:src="@{/pc/assets/js/app.pc.js}"></script>
	<script src="/static/pc/assets/lib/set-iframe-height-child.js" th:src="@{/pc/assets/lib/set-iframe-height-child.js}"></script>
	<script th:inline="javascript">
        vm = new Vue({
	        el: "#vm",
	        data: {
		        lat: [[${lat}]],
		        lng: [[${lng}]],
                signWebDomain: [[${signWebDomain}]],
                points: [
                    {
                        lat: [[${lat}]],
                        lng: [[${lng}]],
                        address: [[${address}]],
                        icon: ctx + "/mapIframe/icon-location.png",
                        iconApp: ctx + "/mapIframe/icon-location-app.png"
                    }
                ]
	        },
            mounted: function () {
				var $this = this;
	            if ($this.lat) {
		            $this.init();
	            }
            },
	        methods: {
                init: function () {
                    var len = $('.static-map-style1 .map-container').length;
                    var obj = $('.static-map-style1').find('.eng-map-container');
                    obj[0].setAttribute('id', 'iframeMapOne' + len);
                    this.mapInit('iframeMapOne' + len);
                },
                mapInit: function (id) {
                    var $this = this;
                    var map = new BMap.Map(id);
                    map.enableScrollWheelZoom(true);
                    var marker = [], pointArr = [];
                    if ($this.points.length < 1) {
                        map.centerAndZoom(new BMap.Point(116.404, 39.915), 15);
                    }
                    $this.points.forEach(function (item, index) {
                        var i = index;
                        var pointObj = item;
                        pointArr[i] = new BMap.Point(pointObj.lng, pointObj.lat);
                        if (i === 0) {
                            map.centerAndZoom(pointArr[i], 15);
                        }
                        if (pointObj.icon) {
                            // 创建图标
                            var myIcon = new BMap.Icon(pointObj.icon, new BMap.Size(26, 30));
                            if ($this.isMobileDevice()) {
                                myIcon = new BMap.Icon(pointObj.iconApp, new BMap.Size(40, 40));
                            }
                            marker[i] = new BMap.Marker(pointArr[i], {
                                icon: myIcon
                            })
                        } else {
                            marker[i] = new BMap.Marker(pointArr[i])
                        }
                        // 将标注添加到地图
                        map.addOverlay(marker[i]);
                        // 创建信息窗口
                        var opts = {
                            position: pointArr[i],    // 指定文本标注所在的地理位置
                            offset: new BMap.Size(-166, -90),    //设置文本偏移量
                            enableMassClear: false,
                        }
                        if ($this.isMobileDevice()) {
                            opts.offset = new BMap.Size(-166, -110);
                            map.disableDragging();
                        }
                        if (!activityApp.isEmpty(pointObj.address)) {
                            var infoWindow = new BMap.Label('', opts);
                            var link = '//api.map.baidu.com/marker?location=' + pointObj.lat + ',' + pointObj.lng + '&title=&content='+pointObj.address+'&output=html&src=webapp.baidu.openAPIdemo';
                            if ($this.isMobileDevice()) {
                                link = $this.signWebDomain + "/map/location?lng=" + pointObj.lng + "&lat=" + pointObj.lat + "&address=" + pointObj.address;
                            }
	                        infoWindow.setContent('<div class="info-window-box"><a href="'+link+'" class="info-link" target="_blank"><div class="center-txt">'+pointObj.address+'</div></a></div>');
                            map.addOverlay(infoWindow);
                        }
                    })
                },
                isMobileDevice: function () {
                    var deviceWid = $(window).width();
                    if (deviceWid < 767) {
                        return true;
                    } else {
                        return false;
                    }
                }
	        }
        });
	</script>
</div>
</body>
</html>