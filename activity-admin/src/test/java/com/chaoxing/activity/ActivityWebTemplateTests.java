package com.chaoxing.activity;

import com.alibaba.fastjson.JSON;
import com.alibaba.fastjson.JSONObject;
import com.chaoxing.activity.util.constant.DomainConstant;
import com.chaoxing.activity.util.exception.BusinessException;
import com.google.common.collect.Lists;
import lombok.extern.slf4j.Slf4j;
import org.junit.jupiter.api.Test;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.web.client.RestTemplate;

import javax.annotation.Resource;
import java.util.List;
import java.util.Objects;

/**
 * @author wwb
 * @version ver 1.0
 * @className ActivityWebTemplateTests
 * @description
 * @blame wwb
 * @date 2022-01-06 10:58:53
 */
@Slf4j
@SpringBootTest
public class ActivityWebTemplateTests {

    @Resource
    private RestTemplate restTemplate;
    private static final String RE_BIND_URL = DomainConstant.API + "/activity/%d/web-template/re-bind";

    @Test
    public void cloneRegionActivity() throws InterruptedException {
        List<Integer> activityIds = Lists.newArrayList(2765571, 2769056, 2769057, 2769067, 2769097, 2770185, 2770189, 2770297, 2770875, 2771844, 2771868, 2771869, 2771870, 2771871, 2771872, 2771873, 2771874, 2771875, 2771876, 2771877, 2771878, 2771879, 2771880, 2771881, 2771882, 2771883, 2771884, 2771885, 2771886, 2771887, 2771888, 2771889, 2771890, 2771891, 2771892, 2771893, 2771894, 2771895, 2771896, 2771897, 2771898, 2771899, 2771900, 2771901, 2771902, 2771903, 2771904, 2771905, 2771906, 2771907, 2771908, 2771909, 2771910, 2771911, 2771912, 2771913, 2771914, 2771915, 2771916, 2771917, 2771918, 2771919, 2771920, 2771921, 2771922, 2771923, 2771924, 2771925, 2771926, 2771927, 2771928, 2771929, 2771930, 2771931, 2771932, 2771933, 2771934, 2771935, 2771936, 2771937, 2771938, 2771939, 2771940, 2771941, 2771942, 2771943, 2771944, 2771945, 2771946, 2771947, 2771948, 2771949, 2771950, 2771951, 2771952, 2771953, 2771954, 2771955, 2771956, 2771957, 2771958, 2771959, 2771960, 2771961, 2771962, 2771963, 2771964, 2771965, 2771966, 2771967, 2771968, 2771969, 2771970, 2771971, 2771972, 2771973, 2771974, 2771975, 2771976, 2771977, 2771978, 2771979, 2771980, 2771981, 2771982, 2771983, 2771984, 2771985, 2771986, 2771987, 2771988, 2771989, 2771990, 2771991, 2771992, 2771993, 2771994, 2771995, 2771996, 2771997, 2771998, 2771999, 2772000, 2772001, 2772002, 2772003, 2772004, 2772005, 2772006, 2772007, 2772008, 2772009, 2772010, 2772011, 2772012, 2772013, 2772014, 2772015, 2772016, 2772017, 2772018, 2772019, 2772020, 2772021, 2772022, 2772023, 2772024, 2772025, 2772026, 2772027, 2772028, 2772029, 2772030, 2772031, 2772032, 2772033, 2772034, 2772035, 2772036, 2772037, 2772038, 2772039, 2772040, 2772041, 2772042, 2772043, 2772044, 2772045, 2772046, 2772047, 2772048, 2772049, 2772050, 2772051, 2772052, 2772053, 2772054, 2772055, 2772056, 2772057, 2772058, 2772059, 2772060, 2772061, 2772062, 2772063, 2772064, 2772065, 2772066, 2772067, 2772068, 2772069, 2772070, 2772071, 2772072, 2772073, 2772074, 2772075, 2772076, 2772077, 2772078, 2772079, 2772080, 2772081, 2772082, 2772083, 2772084, 2772085, 2772086, 2772087, 2772088, 2772089, 2772090, 2772091, 2772092, 2772093, 2772094, 2772095, 2772096, 2772097, 2772098, 2772099, 2772100, 2772101, 2772102, 2772103, 2772104, 2772105, 2772106, 2772107, 2772108, 2772110, 2772111, 2772112, 2772113, 2772114, 2772115, 2772116, 2772117, 2772118, 2772119, 2772120, 2772121, 2772122, 2772123, 2772124, 2772125, 2772126, 2772127, 2772129, 2772130, 2772131, 2772132, 2772133, 2772134, 2772135, 2772136, 2772137, 2772138, 2772139, 2772140, 2772142, 2772143, 2772144, 2772145, 2772146, 2772147, 2772148, 2772149, 2772150, 2772151, 2772152, 2772153, 2772154, 2772156, 2772157, 2772158, 2772159, 2772160, 2772161, 2772162, 2772163, 2772164, 2772165, 2772166, 2772167, 2772168, 2772169, 2772170, 2772171, 2772172, 2772173, 2772174, 2772175, 2772176, 2772177, 2772178, 2772179, 2772180, 2772181, 2772182, 2772183, 2772184, 2772185, 2772186, 2772188, 2772189, 2772190, 2772191, 2772192, 2772193, 2772194, 2772195, 2772196, 2772197, 2772198, 2772199, 2772200, 2772201, 2772202, 2772203, 2772204, 2772205, 2772206, 2772207, 2772208, 2772209, 2772210, 2772211, 2772212, 2772213, 2772214, 2772215, 2772216, 2772217, 2772218, 2772219, 2772220, 2772221, 2772222, 2772223, 2772224, 2772225, 2772226, 2772227, 2772228, 2772229, 2772230, 2772231, 2772232, 2772233, 2772234, 2772235, 2772237, 2772238, 2772239, 2772240, 2772241, 2772242, 2772243, 2772244, 2772245, 2772246, 2772248, 2772249, 2772250, 2772251, 2772252, 2772253, 2772254, 2772255, 2772256, 2772257, 2772259, 2772260, 2772261, 2772262, 2772263, 2772264, 2772265, 2772266, 2772267, 2772269, 2772270, 2772271, 2772272, 2772273, 2772274, 2772275, 2772276, 2772277, 2772278, 2772279, 2772280, 2772281, 2772282, 2772283, 2772284, 2772285, 2772286, 2772287, 2772288, 2772289, 2772290, 2772291, 2772292, 2772293, 2772294, 2772295, 2772296, 2772297, 2772298, 2772299, 2772300, 2772301, 2772302, 2772303, 2772304, 2772305, 2772306, 2772307, 2772308, 2772309, 2772310, 2772311, 2772312, 2772313, 2772314, 2772315, 2772316, 2772317, 2772318, 2772319, 2772320, 2772321, 2772322, 2772323, 2772324, 2772325, 2772326, 2772327, 2772328, 2772330, 2772331, 2772332, 2772333, 2772334, 2772335, 2772336, 2772337, 2772338, 2772339, 2772340, 2772341, 2772342, 2772343, 2772344, 2772345, 2772346, 2772347, 2772348, 2772349, 2772350, 2772351, 2772352, 2772353, 2772354, 2772355, 2772356, 2772357, 2772358, 2772359, 2772360, 2772361, 2772362, 2772363, 2772364, 2772365, 2772366, 2772367, 2772368, 2772369, 2772370, 2772371, 2772372, 2772373, 2772374, 2772375, 2772376, 2772377, 2772378, 2772379, 2772380, 2772381, 2772382, 2772383, 2772384, 2772386, 2772387, 2772388, 2772389, 2772390, 2772391, 2772392, 2772393, 2772394, 2772395, 2772396, 2772397, 2772398, 2772399, 2772400, 2772401, 2772402, 2772403, 2772404, 2772405, 2772406, 2772407, 2772408, 2772410, 2772411, 2772412, 2772413, 2772414, 2772415, 2772416, 2772417, 2772418, 2772419, 2772420, 2772421, 2772422, 2772423, 2772424, 2772425, 2772426, 2772427, 2772428, 2772429, 2772430, 2772431, 2772432, 2772433, 2772434, 2772435, 2772436, 2772437, 2772438, 2772439, 2772440, 2772441, 2772442, 2772443, 2772444, 2772445, 2772446, 2772447, 2772448, 2772449, 2772450, 2772451, 2772452, 2772453, 2772454, 2772455, 2772456, 2772457, 2772458, 2772459, 2772460, 2772461, 2772462, 2772463, 2772464, 2772465, 2772466, 2772467, 2772468, 2772469, 2772470, 2772471, 2772472, 2772473, 2772474, 2772475, 2772476, 2772477, 2772478, 2772479, 2772480, 2772481, 2772482, 2772483, 2772484, 2772485, 2772486, 2772487, 2772488, 2772489, 2772490, 2772491, 2772492, 2772493, 2772494, 2772495, 2772496, 2772497, 2772498, 2772499, 2772500, 2772501, 2772502, 2772503, 2772504, 2772505, 2772506, 2772507, 2772508, 2772509, 2772510, 2772511, 2772512, 2772514, 2772515, 2772516, 2772517, 2772518, 2772519, 2772520, 2772522, 2772523, 2772524, 2772525, 2772526, 2772527, 2772528, 2772529, 2772530, 2772531, 2772532, 2772533, 2772534, 2772535, 2772536, 2772537, 2772538, 2772539, 2772540, 2772541, 2772542, 2772544, 2772545, 2772546, 2772547, 2772549, 2772550, 2772551, 2772552, 2772554, 2772555, 2772556, 2772557, 2772558, 2772559, 2772560, 2772561, 2772562, 2772563, 2772564, 2772565, 2772566, 2772567, 2772568, 2772569, 2772570, 2772571, 2772572, 2772574, 2772575, 2772576, 2772577, 2772578, 2772579, 2772580, 2772581, 2772582, 2772583, 2772584, 2772585, 2772586, 2772587, 2772588, 2772589, 2772590, 2772591, 2772592, 2772593, 2772594, 2772595, 2772596, 2772597, 2772598, 2772599, 2772600, 2772601, 2772602, 2772603, 2772604, 2772605, 2772606, 2772607, 2772608, 2772609, 2772610, 2772611, 2772612, 2772613, 2772614, 2772615, 2772616, 2772617, 2772618, 2772619, 2772620, 2772621, 2772622, 2772623, 2772624, 2772625, 2772626, 2772627, 2772628, 2772629, 2772630, 2772631, 2772632, 2772633, 2772634, 2772635, 2772636, 2772637, 2772638, 2772639, 2772640, 2772641, 2772642, 2772643, 2772644, 2772645, 2772646, 2772647, 2772648, 2772649, 2772650, 2772651, 2772652, 2772653, 2772654, 2772655, 2772656, 2772657, 2772658, 2772659, 2772660, 2772661, 2772662, 2772663, 2772664, 2772665, 2772666, 2772667, 2772668, 2772669, 2772670, 2772671, 2772672, 2772673, 2772674, 2772675, 2772676, 2772677, 2772678, 2772679, 2772681, 2772682, 2772683, 2772684, 2772685, 2772686, 2772687, 2772689, 2772690, 2772691, 2772692, 2772693, 2772694, 2772695, 2772696, 2772697, 2772698, 2772750, 2772752, 2772777, 2772783, 2772801, 2772802, 2772803);
        int activityIndex = 0;
        int activityIdSize = activityIds.size();
        for (int i = activityIndex; i < activityIdSize; i++) {
            int activityId = activityIds.get(i);
            String url = String.format(RE_BIND_URL, activityId);
            String result = restTemplate.getForObject(url, String.class);
            JSONObject jsonObject = JSON.parseObject(result);
            if (!Objects.equals(true, jsonObject.getBoolean("success"))) {
                String message = jsonObject.getString("message");
                log.error("活动下标:{}, 重新绑定网页模板error:{}", i, message);
                throw new BusinessException(message);
            }
            System.out.println("活动:" + activityId + "重新绑定网页模板成功");
            Thread.sleep(13 * 1000);
        }
    }

}
