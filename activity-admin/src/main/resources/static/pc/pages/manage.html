<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../assets/css/create.css">
    <link rel="stylesheet" href="../assets/lib/element-ui/lib/theme-chalk/index.css">
    <link rel="stylesheet" href="../assets/lib/zTree_v3/css/zTreeStyle/zTreeStyle.css" type="text/css">
    <link rel="stylesheet" href="../assets/css/reset.css">
    <link rel="stylesheet" href="../assets/css/public.css">
    <link rel="stylesheet" href="../assets/css/manage.css">
    <link rel="stylesheet" href="../assets/lib/jquery.mCustomScrollbar.css">
    <title>活动管理</title>
</head>

<body>
    <div class="page" id="app">
        <div class="top box">
            活动管理
        </div>
        <div class="main box">
            <div class="manage-create-btn">
                <img src="../assets/images/icon-add.png">
                <div class="text">
                    创建活动
                </div>
            </div>
            <div class="search-Box">
                <el-input placeholder="搜索"
                          icon="search"
                          class="search"
                          v-model="search"
                          maxlength="10"
                          suffix-icon="el-icon-search">
                </el-input>
                <img class="btn-cancel" style="display: block;" src="../assets/images/icon-cancel.png">
            </div>
            <div class="table">
                <el-table :data="tableData" style="width: 100%">
                    <el-table-column prop="name" label="活动名称" min-width="32.5%">
                        <template slot-scope="scope">
                            <div class="img">
                                <img class="jqthumbImg" src="../assets/images/无标题.png">
                            </div>
                            <div class="desc">
                                <div class="title">2020年星阅读活动</div>
                                <div class="time"><span>2019年10月1日 16:00</span> - <span>2019年10月1日 16:00</span></div>
                            </div>
                        </template>
                    </el-table-column>
                    <el-table-column prop="address" label="创建单位" min-width="20%">
                        <template slot-scope="scope">
                            <div class="overHidden2">{{scope.row.address}}</div>
                        </template>
                    </el-table-column>
                    <el-table-column prop="person" label="创建人" min-width="10%">
                        <template slot-scope="scope">
                            <div class="overHidden2">{{scope.row.person}}</div>
                        </template>
                    </el-table-column>
                    <el-table-column prop="state" label="状态" min-width="10%">
                        <template slot="header" slot-scope="scope">
                            <div class="status">状态<i class="el-icon-arrow-down el-down"></i></div>
                            <div class="filters">
                                <p>全部</p>
                                <p>进行中</p>
                                <p>未发布</p>
                                <p>已结束</p>
                            </div>
                        </template>
                        <template slot-scope="scope">
                            <span
                                :class="scope.row.state=='进行中'?'green':scope.row.state=='未发布'?'blue2':scope.row.state=='已结束'?'end_color':''">{{scope.row.state}}</span>
                        </template>
                    </el-table-column>
                    <el-table-column label="操作" min-width="20%">
                        <template slot-scope="scope">
                            <div v-show="scope.row.state == '进行中'">
                                <el-button type="text">下载</el-button>
                                <el-button type="text">编辑</el-button>
                                <el-button type="text">管理</el-button>
                                <div class="manage-more-btn">
                                    <!--<el-button type="text">更多<i class="el-icon-arrow-down"></i></el-button>-->
                                    <el-button type="text"><img src="../assets/images/more-vertical.png"></el-button>
                                    <div class="more">
                                        <p>全部</p>
                                        <p>进行中</p>
                                        <p>未发布</p>
                                    </div>
                                </div>

                            </div>
                            <div v-show="scope.row.state == '未发布'">
                                <el-button type="text" @click="handleRelease">发布</el-button>
                                <el-button type="text">编辑</el-button>
                                <el-button type="text">管理</el-button>
                                <div class="manage-more-btn">
                                    <!--<el-button type="text">更多<i class="el-icon-arrow-down"></i></el-button>-->
                                    <el-button type="text"><img src="../assets/images/more-vertical.png"></el-button>
                                    <div class="more">
                                        <p>全部</p>
                                        <p>进行中</p>
                                        <p>发布范围</p>
                                    </div>
                                </div>
                            </div>
                            <div v-show="scope.row.state == '已结束'">
                                <el-button type="text" @click="handleXia">下架</el-button>
                                <el-button type="text">统计</el-button>
                            </div>
                        </template>
                    </el-table-column>
                    <template slot="empty">
                        <div class="noData">
                            暂无内容
                        </div>
                    </template>
                </el-table>
            </div>
           
            <el-pagination background layout="prev, pager, next" :total="10">
            </el-pagination>
            <!-- 确认下架 -->
            <div class="dailog-box1" v-show="deleteShow">
                <div class="dailog delete-dailog">
                    <img src="../assets/images/warning.png" alt="" class="warn">
                    <span>下架后，该活动将不在活动广场中显示</span>
                    <div>
                        <div class="normal-btn cancle" @click="handleCancle">取消</div>
                        <div class="normal-btn after-sure">下架</div>
                    </div>
                </div>
            </div>
            <!-- 活动发布弹窗 -->
            <div class="dailog-box1" v-show="releaseShow">
                <div class="dailog">
                    <div class="header">
                        <span>活动发布</span>
                        <img src="../assets/images/close.png" alt="" @click="close" class="close"> 
                    </div>
                    <div class="body">
                        <div class="tree">
                            <div class="tree-head">
                                <span>选择发布的范围</span>
                                <div class="already">已选<span style="margin-left: 5px;">0</span></div>
                            </div>
                            <div class="tree-box">
                                <div id="organizationTree" class="ztree"></div>
                            </div>
                        </div>
                    </div>
                    <div class="footer">
                        <div class="normal-btn cancle" @click="handleCancle">取消</div>
                        <div class="normal-btn after-sure">发布</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="../assets/lib/jquery.min.js"></script>
    <script src="../assets/lib/vue.js"></script>
    <script src="../assets/lib/element-ui/lib/index.js"></script>
    <script src="../assets/lib/jquery.mousewheel.min.js"></script>
    <script src="../assets/lib/jquery.mCustomScrollbar.js"></script>
    <script src="../assets/lib/zTree_v3/js/jquery.ztree.core.js"></script>
    <script src="../assets/lib/zTree_v3/js/jquery.ztree.excheck.min.js"></script>
    <script type="text/javascript" src="../assets/lib/zTree_v3/js/jquery.ztree.exedit.js"></script>
    <script src="../assets/lib/jqthumb.min.js"></script>
    <script>
        var app = new Vue({
            el: '#app',
            data: {
                tableData: [{
                    name: '王小虎',
                    address: '超星小学122222222223333333333333',
                    state: '进行中',
                    person: '邱强'
                }, {
                    name: '王小虎',
                    address: '超星小学122222222223333333333333',
                    state: '未发布',
                    person: '邱强'
                }, {
                    name: '王小虎',
                    address: '超星小学122222222223333333333333',
                    state: '已结束',
                    person: '邱强'
                }],
                deleteShow: false,
                releaseShow: false,
            },
            mounted: function () {
                this.organizationTreeFun();
            },
            methods: {
                filterTag(value, row) {
                    return row.state === value;
                },
                handleXia() {
                    this.deleteShow = true
                    $('body').addClass('scroll')
                },
                handleCancle() {
                    this.deleteShow = false
                    this.releaseShow = false
                    $('body').removeClass('scroll')
                },
                close() {
                    this.releaseShow = false
                    $('body').removeClass('scroll')
                },
                handleRelease() {
                    this.releaseShow = true
                    $('body').addClass('scroll')
                },
                organizationTreeFun() {
                    var setting = {
                        check: {
                            enable: true
                        },
                        data: {
                            simpleData: {
                                enable: true
                            }
                        },
                        callback: {
                            onCheck: zTreeOnCheck
                        },
                        view: {
                            // showIcon: false,
                        }
                    };
                    var zNodes = [{
                            id: 1,
                            pId: 0,
                            name: "一级",
                            open: true
                        },
                        {
                            id: 2,
                            pId: 0,
                            name: "一级",
                            open: true
                        },
                        {
                            id: 3,
                            pId: 0,
                            name: "一级",
                            open: false
                        },
                        {
                            id: 10,
                            pId: 1,
                            name: "二级"
                        },
                        {
                            id: 10,
                            pId: 1,
                            name: "二级"
                        },{
                            id: 13,
                            pId: 10,
                            name: "二级"
                        },{
                            id: 14,
                            pId: 11,
                            name: "二级"
                        },
                        {
                            id: 12,
                            pId: 1,
                            name: "二级"
                        },
                        {
                            id: 4,
                            pId: 2,
                            name: "二级"
                        },
                        {
                            id: 5,
                            pId: 2,
                            name: "二级"
                        },
                        {
                            id: 6,
                            pId: 2,
                            name: "二级"
                        },
                        {
                            id: 7,
                            pId: 3,
                            name: "二级"
                        }
                    ];

                    function zTreeOnCheck(event, treeId, treeNode) {
                        clearCheckedOldNodes();
                    };
                    //  清理善后工作
                    function clearCheckedOldNodes() {
                        var zTree = $.fn.zTree.getZTreeObj("organizationTree"),
                            nodes = zTree.getChangeCheckedNodes();
                        console.log(nodes)
                        for (var i = 0, l = nodes.length; i < l; i++) {
                            nodes[i].checkedOld = nodes[i].checked;
                            console.log(nodes)
                        }
                    };
                    $.fn.zTree.init($("#organizationTree"), setting, zNodes);
                }
            }
        })
    </script>
    <script>
        $(function () {
            $('.jqthumbImg').jqthumb({
                width:'100%',
                height:'100%'
            });
        });
        $('.status').click(function () {
            $('.filters').toggle()
            $('.el-down').toggleClass('rotate')
        })
        $('.filters p').click(function () {
            $(this).addClass('blue').siblings().removeClass('blue')
            $('.filters').hide()
            $('.el-down').removeClass('rotate')
        })
        $('.manage-more-btn').mouseover(function () {
            $(this).children('.more').show();
        })
        $('.manage-more-btn').mouseout(function () {
            $(this).children('.more').hide();
        })
        $('.more p').click(function () {
            $(this).parent('.more').hide()
        })
    </script>
</body>

</html>